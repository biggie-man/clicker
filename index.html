<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Click Empire</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Fredoka', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    html, body {
      height: 100%;
      width: 100%;
    }

    body {
      background: linear-gradient(135deg, #581c87 0%, #312e81 50%, #1e293b 100%);
      color: white;
      overflow: auto;
    }

    #app {
      display: flex;
      flex-direction: column;
      height: 100%;
      width: 100%;
    }

    header {
      background: rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(4px);
      border-bottom: 1px solid rgba(234, 179, 8, 0.3);
      padding: 1rem;
    }

    header .container {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    h1 {
      font-size: 2rem;
      font-weight: 700;
      color: #facc15;
    }

    .coin-display {
      background: rgba(234, 179, 8, 0.2);
      border: 1px solid rgba(234, 179, 8, 0.5);
      border-radius: 9999px;
      padding: 0.5rem 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: bold;
      color: #facc15;
    }

    nav {
      background: rgba(0, 0, 0, 0.2);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      overflow-x: auto;
    }

    .tab-btn {
      padding: 0.75rem 1.5rem;
      font-weight: 600;
      border: none;
      cursor: pointer;
      background: none;
      color: rgba(255, 255, 255, 0.6);
      border-bottom: 2px solid transparent;
      transition: all 0.2s ease;
      white-space: nowrap;
    }

    .tab-btn.active {
      color: #facc15;
      border-bottom-color: #facc15;
      background: rgba(250, 204, 21, 0.1);
    }

    .tab-btn:hover:not(.disabled) {
      color: rgba(255, 255, 255, 0.8);
    }

    .tab-btn.disabled {
      cursor: not-allowed;
      opacity: 0.5;
    }

    main {
      flex: 1;
      overflow: auto;
      padding: 1.5rem;
    }

    .tab-content {
      display: none;
      animation: fadeIn 0.3s ease;
    }

    .tab-content.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .clicker-container {
      max-width: 500px;
      margin: 0 auto;
      text-align: center;
    }

    .stats {
      margin-bottom: 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .stat-line {
      color: rgba(255, 255, 255, 0.6);
    }

    .stat-value {
      font-weight: bold;
      color: #4ade80;
    }

    .click-button {
      width: 250px;
      height: 250px;
      border-radius: 50%;
      background: linear-gradient(to bottom right, #facc15, #f59e0b, #ea580c);
      border: 4px solid #fcd34d;
      font-size: 5rem;
      cursor: pointer;
      margin: 2rem auto;
      box-shadow: 0 0 30px rgba(250, 204, 21, 0.5);
      transition: all 0.1s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .click-button:hover {
      transform: scale(1.05);
    }

    .click-button:active {
      transform: scale(0.95);
    }

    @keyframes floatUp {
      0% { opacity: 1; transform: translateY(0) scale(1); }
      100% { opacity: 0; transform: translateY(-80px) scale(1.5); }
    }

    .floating-text {
      position: absolute;
      color: #facc15;
      font-weight: bold;
      font-size: 1.5rem;
      animation: floatUp 0.8s ease-out forwards;
      pointer-events: none;
    }

    .upgrades-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1rem;
      max-width: 1200px;
      margin: 0 auto;
    }

    .upgrade-card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(4px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 0.75rem;
      padding: 1rem;
      transition: all 0.2s ease;
    }

    .upgrade-card:hover {
      transform: translateY(-2px);
      border-color: rgba(250, 204, 21, 0.5);
    }

    .upgrade-card.special {
      border-color: rgba(34, 197, 94, 0.5);
      background: rgba(20, 83, 45, 0.2);
    }

    .upgrade-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 0.5rem;
    }

    .upgrade-name {
      font-weight: bold;
      font-size: 1rem;
    }

    .upgrade-card.special .upgrade-name {
      color: #4ade80;
    }

    .owned-badge {
      color: #4ade80;
      font-size: 0.75rem;
    }

    .upgrade-desc {
      color: rgba(255, 255, 255, 0.6);
      font-size: 0.875rem;
      margin-bottom: 0.75rem;
    }

    .upgrade-button {
      width: 100%;
      padding: 0.5rem;
      border: none;
      border-radius: 0.5rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .upgrade-button.available {
      background: #eab308;
      color: black;
    }

    .upgrade-button.available:hover {
      background: #facc15;
    }

    .upgrade-button.disabled {
      background: #4b5563;
      color: #9ca3af;
      cursor: not-allowed;
    }

    .upgrade-button.owned {
      background: rgba(34, 197, 94, 0.3);
      color: #4ade80;
      cursor: not-allowed;
    }

    .farm-container {
      max-width: 1000px;
      margin: 0 auto;
    }

    .farm-header {
      text-align: center;
      margin-bottom: 1.5rem;
    }

    .farm-title {
      font-size: 1.875rem;
      font-weight: bold;
      color: #4ade80;
      margin-bottom: 0.5rem;
    }

    .farm-info {
      color: rgba(255, 255, 255, 0.6);
      font-size: 0.875rem;
    }

    .farm-upgrades {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 0.75rem;
      margin-bottom: 1.5rem;
      background: rgba(0, 0, 0, 0.2);
      padding: 1rem;
      border-radius: 0.75rem;
    }

    .farm-upgrade-btn {
      padding: 0.5rem;
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 0.5rem;
      font-weight: bold;
      background: rgba(255, 255, 255, 0.05);
      color: rgba(255, 255, 255, 0.8);
      cursor: pointer;
      font-size: 0.875rem;
      transition: all 0.2s ease;
    }

    .farm-upgrade-btn:hover:not(:disabled) {
      border-color: rgba(139, 92, 246, 0.5);
      background: rgba(139, 92, 246, 0.1);
    }

    .farm-upgrade-btn.available {
      background: rgba(139, 92, 246, 0.2);
      border-color: rgba(139, 92, 246, 0.5);
      color: #c4b5fd;
    }

    .farm-upgrade-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .plant-selector {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 1.5rem;
    }

    .plant-btn {
      padding: 0.75rem 1rem;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 0.75rem;
      font-weight: bold;
      background: none;
      color: rgba(255, 255, 255, 0.6);
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 0.85rem;
      white-space: nowrap;
    }

    .plant-btn:hover:not(:disabled) {
      border-color: rgba(250, 204, 21, 0.5);
    }

    .plant-btn.active {
      border-color: #facc15;
      background: rgba(250, 204, 21, 0.1);
      color: #facc15;
    }

    .plant-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .farm-instruction {
      text-align: center;
      color: rgba(255, 255, 255, 0.4);
      font-size: 0.875rem;
      margin-bottom: 1rem;
    }

    .farm-grid {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 0.75rem;
      margin-bottom: 1.5rem;
      max-width: 500px;
      margin-left: auto;
      margin-right: auto;
    }

    .farm-plot {
      aspect-ratio: 1;
      background: rgba(180, 83, 9, 0.5);
      border: 2px solid rgba(180, 83, 9, 0.5);
      border-radius: 0.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      cursor: pointer;
      user-select: none;
      transition: all 0.2s ease;
    }

    .farm-plot:hover {
      background: rgba(180, 83, 9, 0.7);
    }

    .farm-plot:active {
      transform: scale(0.95);
    }

    .farm-plot.growing {
      opacity: 0.6;
      filter: brightness(0.8) grayscale(0.3);
    }

    .farm-plot.ready {
      filter: brightness(1.2);
      animation: glowPulse 1s ease-in-out infinite;
    }

    @keyframes glowPulse {
      0%, 100% { box-shadow: 0 0 10px rgba(139, 92, 246, 0.5); }
      50% { box-shadow: 0 0 20px rgba(139, 92, 246, 0.8); }
    }

    @keyframes mutate {
      0% { transform: scale(1) rotate(0deg); }
      50% { transform: scale(1.2) rotate(180deg); }
      100% { transform: scale(1) rotate(360deg); }
    }

    .farm-plot.mutating {
      animation: mutate 0.6s ease-out;
    }

    @keyframes shake {
      0%, 100% { transform: rotate(0deg); }
      25% { transform: rotate(-5deg); }
      75% { transform: rotate(5deg); }
    }

    .farm-plot.harvesting {
      animation: shake 0.3s ease;
    }

    .farm-buttons {
      display: flex;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
    }

    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 0.75rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-harvest {
      background: #ca8a04;
      color: white;
    }

    .btn-harvest:hover {
      background: #eab308;
    }

    .btn-clear {
      background: #dc2626;
      color: white;
    }

    .btn-clear:hover {
      background: #ef4444;
    }

    footer {
      background: rgba(0, 0, 0, 0.3);
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      padding: 0.75rem;
      text-align: center;
      font-size: 0.875rem;
      color: rgba(255, 255, 255, 0.5);
    }

    .footer-stat {
      display: inline-block;
      margin: 0 1.5rem;
    }

    .footer-value {
      color: #4ade80;
      font-weight: bold;
    }

    @media (max-width: 768px) {
      h1 {
        font-size: 1.5rem;
      }

      .click-button {
        width: 180px;
        height: 180px;
        font-size: 3.5rem;
      }

      .tab-btn {
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
      }

      .farm-grid {
        max-width: 100%;
      }

      .plant-btn {
        font-size: 0.75rem;
        padding: 0.5rem 0.75rem;
      }
    }
  </style>
  <style>body { box-sizing: border-box; }</style>
  <script src="https://cdn.tailwindcss.com/3.4.17" type="text/javascript"></script>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body>
  <div id="app">
   <header>
    <div class="container">
     <h1>üí∞ Click Empire</h1>
     <div class="coin-display"><span>ü™ô</span> <span id="coin-display">0</span>
     </div>
    </div>
   </header>
   <nav><button class="tab-btn active" data-tab="clicker">üéØ Clicker</button> <button class="tab-btn" data-tab="upgrades">‚¨ÜÔ∏è Upgrades</button> <button class="tab-btn disabled" data-tab="farm" id="tab-farm">üîí Farm</button>
   </nav>
   <main>
    <div id="clicker-tab" class="tab-content active">
     <div class="clicker-container">
      <div class="stats">
       <div class="stat-line">
        Click Power: <span class="stat-value" id="click-power">1</span>
       </div>
       <div class="stat-line">
        Multiplier: <span class="stat-value" id="multiplier">1x</span>
       </div>
       <div class="stat-line">
        Auto-Clickers: <span class="stat-value" id="auto-clickers">0</span>/sec
       </div>
       <div class="stat-line">
        Total Clicks: <span class="stat-value" id="total-clicks">0</span>
       </div>
      </div>
      <div style="position: relative; display: inline-block;"><button class="click-button" id="main-click-btn">üí∞</button>
       <div id="click-container"></div>
      </div>
      <p style="color: rgba(255, 255, 255, 0.4); font-size: 0.875rem;">Click the coin to earn money!</p>
     </div>
    </div>
    <div id="upgrades-tab" class="tab-content">
     <h2 style="text-align: center; font-size: 1.875rem; font-weight: bold; margin-bottom: 1.5rem; color: #facc15;">üõí Upgrade Shop</h2>
     <div class="upgrades-grid" id="upgrades-grid"></div>
    </div>
    <div id="farm-tab" class="tab-content">
     <div class="farm-container">
      <div class="farm-header">
       <div class="farm-title">
        üåæ Your Farm
       </div>
       <div class="farm-info">
        Coins: <span id="farm-coins" style="color: #facc15; font-weight: bold;">0</span>
       </div>
       <div class="farm-info">
        Grow Time: <span id="grow-time-display" style="color: #c4b5fd; font-weight: bold;">10s</span> | Mutation Rate: <span id="mutation-rate-display" style="color: #c4b5fd; font-weight: bold;">35%</span>
       </div>
      </div>
      <div class="farm-upgrades"><button class="farm-upgrade-btn" id="farm-upgrade-speed" onclick="buyFarmUpgrade('speed')">‚ö° Speed Up ($500)</button> <button class="farm-upgrade-btn" id="farm-upgrade-mutation" onclick="buyFarmUpgrade('mutation')">‚ú® More Mutations ($750)</button>
      </div>
      <div class="plant-selector" id="plant-selector"></div>
      <p class="farm-instruction">Click a plant type, then click plots to plant. Double-click to fill! Hover over grown plants to harvest! üéØ</p>
      <div class="farm-grid" id="farm-grid"></div>
      <div class="farm-buttons"><button class="btn btn-harvest" id="harvest-all-btn">üåæ Harvest All</button> <button class="btn btn-clear" id="clear-farm-btn">üóëÔ∏è Clear Farm</button>
      </div>
     </div>
    </div>
   </main>
   <footer>
    <div class="footer-stat">
     üíµ Per Click: <span class="footer-value" id="per-click">1</span>
    </div>
    <div class="footer-stat">
     ‚è±Ô∏è Per Second: <span class="footer-value" id="per-second">0</span>
    </div>
   </footer>
  </div>
  <script>
    let localState = {
      coins: 0,
      clicks: 0,
      click_power: 1,
      auto_clickers: 0,
      multiplier: 1,
      farm_unlocked: false,
      farm_plots: {},
      farm_speed_level: 0,
      farm_mutation_level: 0
    };

    let selectedPlant = null;

    const BASE_GROW_TIME_MS = 10000;
    const BASE_MUTATION_CHANCE = 0.35;
    const PLANT_EARNINGS_MULTIPLIER = 10;

    const plantTypes = {
      sunflower: { emoji: 'üåª', cost: 150, value: 150 },
      tomato: { emoji: 'üçÖ', cost: 200, value: 200 },
      corn: { emoji: 'üåΩ', cost: 250, value: 250 },
      carrot: { emoji: 'ü•ï', cost: 300, value: 300 },
      pepper: { emoji: 'ü´ë', cost: 350, value: 350 },
      grape: { emoji: 'üçá', cost: 400, value: 400 },
      watermelon: { emoji: 'üçâ', cost: 450, value: 450 },
      mushroom: { emoji: 'üçÑ', cost: 500, value: 500 },
      pumpkin: { emoji: 'üéÉ', cost: 550, value: 550 },
      coconut: { emoji: 'ü••', cost: 600, value: 600 },
      golden: { emoji: '‚ú®', cost: 1000, value: 1000, special: true }
    };

    const upgrades = [
      // Click Power
      { id: 'click1', name: 'üñ±Ô∏è Better Mouse', desc: '+1 Click Power', cost: 10, type: 'click_power', value: 1 },
      { id: 'click2', name: 'üéØ Precision Click', desc: '+5 Click Power', cost: 100, type: 'click_power', value: 5 },
      { id: 'lucky1', name: 'üçÄ Lucky Charm', desc: '+2 Click Power', cost: 150, type: 'click_power', value: 2 },
      { id: 'click3', name: '‚ö° Power Click', desc: '+25 Click Power', cost: 500, type: 'click_power', value: 25 },
      { id: 'gold1', name: 'ü•á Gold Touch', desc: '+50 Click Power', cost: 1500, type: 'click_power', value: 50 },
      { id: 'click4', name: 'üíé Diamond Click', desc: '+100 Click Power', cost: 2500, type: 'click_power', value: 100 },
      { id: 'click5', name: 'üåü Star Click', desc: '+500 Click Power', cost: 15000, type: 'click_power', value: 500 },
      
      // Auto Clickers / Per Second
      { id: 'auto1', name: 'ü§ñ Auto Clicker', desc: '+1 Click/sec', cost: 50, type: 'auto_clickers', value: 1 },
      { id: 'auto2', name: 'ü¶æ Robot Arm', desc: '+5 Clicks/sec', cost: 300, type: 'auto_clickers', value: 5 },
      { id: 'auto3', name: 'üè≠ Click Factory', desc: '+25 Clicks/sec', cost: 2000, type: 'auto_clickers', value: 25 },
      { id: 'time1', name: '‚è∞ Time Warp', desc: '+50 Clicks/sec', cost: 5000, type: 'auto_clickers', value: 50 },
      { id: 'auto4', name: 'üöÄ Click Rocket', desc: '+100 Clicks/sec', cost: 10000, type: 'auto_clickers', value: 100 },
      { id: 'auto5', name: 'üåå Click Galaxy', desc: '+500 Clicks/sec', cost: 75000, type: 'auto_clickers', value: 500 },
      
      // Multipliers
      { id: 'mult1', name: 'üìà 2x Multiplier', desc: 'Double earnings!', cost: 200, type: 'multiplier', value: 2 },
      { id: 'mult2', name: 'üî• 3x Multiplier', desc: 'Triple earnings!', cost: 1000, type: 'multiplier', value: 3 },
      { id: 'mult3', name: 'üí´ 5x Multiplier', desc: '5x earnings!', cost: 5000, type: 'multiplier', value: 5 },
      { id: 'mult4', name: 'üåà 10x Multiplier', desc: '10x earnings!', cost: 25000, type: 'multiplier', value: 10 },
      
      // Special
      { id: 'farm', name: 'üåæ Mega Farm', desc: 'Unlock farming!', cost: 1000, type: 'farm_unlocked', value: true, special: true },
    ];

    function initGame() {
      loadFromLocalStorage();
      
      document.getElementById('main-click-btn').addEventListener('click', handleClick);
      document.getElementById('harvest-all-btn').addEventListener('click', harvestAll);
      document.getElementById('clear-farm-btn').addEventListener('click', clearFarm);
      
      document.querySelectorAll('[data-tab]').forEach(btn => {
        btn.addEventListener('click', () => switchTab(btn.dataset.tab));
      });
      
      renderPlantButtons();
      renderUpgrades();
      renderFarmGrid();
      updateUI();
      
      setInterval(updatePlantGrowth, 500);
      setInterval(autoClick, 1000);
    }

    function loadFromLocalStorage() {
      const saved = localStorage.getItem('clickGameState');
      if (saved) {
        try {
          localState = JSON.parse(saved);
        } catch (e) {
          console.log('Fresh start');
        }
      }
    }

    function saveToLocalStorage() {
      localStorage.setItem('clickGameState', JSON.stringify(localState));
    }

    function formatNumber(num) {
      if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
      if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
      return Math.floor(num).toString();
    }

    function getGrowTime() {
      return Math.max(1000, BASE_GROW_TIME_MS / (1 + localState.farm_speed_level * 0.5));
    }

    function getMutationChance() {
      return Math.min(0.9, BASE_MUTATION_CHANCE + localState.farm_mutation_level * 0.15);
    }

    function handleClick() {
      const earned = localState.click_power * localState.multiplier;
      
      const btn = document.getElementById('main-click-btn');
      btn.style.transform = 'scale(0.95)';
      setTimeout(() => {
        btn.style.transform = '';
      }, 100);
      
      createFloatingCoin(earned);
      
      localState.coins += earned;
      localState.clicks += 1;
      
      saveToLocalStorage();
      updateUI();
    }

    function createFloatingCoin(amount) {
      const container = document.getElementById('click-container');
      const floater = document.createElement('div');
      floater.className = 'floating-text';
      floater.textContent = '+$' + formatNumber(amount);
      floater.style.left = Math.random() * 100 + 'px';
      floater.style.top = '50%';
      container.appendChild(floater);
      setTimeout(() => floater.remove(), 800);
    }

    function autoClick() {
      if (localState.auto_clickers > 0) {
        const earned = localState.auto_clickers * localState.multiplier;
        localState.coins += earned;
        saveToLocalStorage();
        updateUI();
      }
    }

    function updateUI() {
      document.getElementById('coin-display').textContent = formatNumber(localState.coins);
      document.getElementById('farm-coins').textContent = formatNumber(localState.coins);
      document.getElementById('click-power').textContent = localState.click_power;
      document.getElementById('multiplier').textContent = localState.multiplier + 'x';
      document.getElementById('auto-clickers').textContent = localState.auto_clickers;
      document.getElementById('total-clicks').textContent = formatNumber(localState.clicks);
      document.getElementById('per-click').textContent = formatNumber(localState.click_power * localState.multiplier);
      document.getElementById('per-second').textContent = formatNumber(localState.auto_clickers * localState.multiplier);
      
      // Update farm display
      document.getElementById('grow-time-display').textContent = (getGrowTime() / 1000).toFixed(1) + 's';
      document.getElementById('mutation-rate-display').textContent = Math.round(getMutationChance() * 100) + '%';
      
      // Update farm upgrade buttons
      const speedBtn = document.getElementById('farm-upgrade-speed');
      const speedCost = 500 * (localState.farm_speed_level + 1);
      speedBtn.textContent = '‚ö° Speed Up ($' + formatNumber(speedCost) + ')';
      speedBtn.disabled = localState.coins < speedCost;
      speedBtn.classList.toggle('available', localState.coins >= speedCost);
      
      const mutationBtn = document.getElementById('farm-upgrade-mutation');
      const mutationCost = 750 * (localState.farm_mutation_level + 1);
      mutationBtn.textContent = '‚ú® More Mutations ($' + formatNumber(mutationCost) + ')';
      mutationBtn.disabled = localState.coins < mutationCost;
      mutationBtn.classList.toggle('available', localState.coins >= mutationCost);
      
      if (localState.farm_unlocked) {
        const farmBtn = document.getElementById('tab-farm');
        farmBtn.classList.remove('disabled');
        farmBtn.textContent = 'üåæ Farm';
      }
      
      renderUpgrades();
      updateFarmGrid();
    }

    function renderPlantButtons() {
      const selector = document.getElementById('plant-selector');
      selector.innerHTML = Object.entries(plantTypes).map(([key, plant]) => {
        return `<button class="plant-btn" data-plant="${key}">${plant.emoji} ${key.charAt(0).toUpperCase() + key.slice(1)} ($${plant.cost})</button>`;
      }).join('');

      document.querySelectorAll('[data-plant]').forEach(btn => {
        btn.addEventListener('click', () => selectPlant(btn.dataset.plant));
      });
    }

    function renderUpgrades() {
      const grid = document.getElementById('upgrades-grid');
      grid.innerHTML = upgrades.map(upgrade => {
        const canAfford = localState.coins >= upgrade.cost;
        const isFarmAndOwned = upgrade.id === 'farm' && localState.farm_unlocked;
        
        return `
          <div class="upgrade-card ${upgrade.special ? 'special' : ''}">
            <div class="upgrade-header">
              <div class="upgrade-name">${upgrade.name}</div>
              ${isFarmAndOwned ? '<span class="owned-badge">‚úì Owned</span>' : ''}
            </div>
            <div class="upgrade-desc">${upgrade.desc}</div>
            <button class="upgrade-button ${
              isFarmAndOwned ? 'owned' : canAfford ? 'available' : 'disabled'
            }" 
            onclick="buyUpgrade('${upgrade.id}')"
            ${isFarmAndOwned || !canAfford ? 'disabled' : ''}>
              ${isFarmAndOwned ? '‚úì Purchased' : '$' + formatNumber(upgrade.cost)}
            </button>
          </div>
        `;
      }).join('');
    }

    function buyUpgrade(id) {
      const upgrade = upgrades.find(u => u.id === id);
      
      if (!upgrade || localState.coins < upgrade.cost) return;
      if (upgrade.id === 'farm' && localState.farm_unlocked) return;
      
      localState.coins -= upgrade.cost;
      
      if (upgrade.type === 'click_power') {
        localState.click_power += upgrade.value;
      } else if (upgrade.type === 'auto_clickers') {
        localState.auto_clickers += upgrade.value;
      } else if (upgrade.type === 'multiplier') {
        localState.multiplier += upgrade.value;
      } else if (upgrade.type === 'farm_unlocked') {
        localState.farm_unlocked = true;
      }
      
      saveToLocalStorage();
      updateUI();
    }

    function buyFarmUpgrade(type) {
      if (type === 'speed') {
        const cost = 500 * (localState.farm_speed_level + 1);
        if (localState.coins >= cost) {
          localState.coins -= cost;
          localState.farm_speed_level += 1;
        }
      } else if (type === 'mutation') {
        const cost = 750 * (localState.farm_mutation_level + 1);
        if (localState.coins >= cost) {
          localState.coins -= cost;
          localState.farm_mutation_level += 1;
        }
      }
      saveToLocalStorage();
      updateUI();
    }

    function selectPlant(type) {
      if (type === 'golden') return;
      selectedPlant = selectedPlant === type ? null : type;
      
      document.querySelectorAll('[data-plant]').forEach(btn => {
        btn.classList.remove('active');
      });
      
      if (selectedPlant) {
        document.querySelector(`[data-plant="${selectedPlant}"]`).classList.add('active');
      }
    }

    function switchTab(tab) {
      if (tab === 'farm' && !localState.farm_unlocked) return;
      
      document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
      document.querySelectorAll('[data-tab]').forEach(el => el.classList.remove('active'));
      
      document.getElementById(tab + '-tab').classList.add('active');
      document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
    }

    function renderFarmGrid() {
      const grid = document.getElementById('farm-grid');
      grid.innerHTML = '';
      for (let i = 0; i < 24; i++) {
        const plot = document.createElement('div');
        plot.id = 'plot-' + i;
        plot.className = 'farm-plot';
        plot.addEventListener('click', () => plantSinglePlot(i));
        plot.addEventListener('dblclick', (e) => { e.preventDefault(); plantMultiplePlots(i); });
        plot.addEventListener('mouseenter', () => hoverHarvest(i));
        grid.appendChild(plot);
      }
      updateFarmGrid();
    }

    function updateFarmGrid() {
      document.querySelectorAll('[id^="plot-"]').forEach((plot, i) => {
        const plotData = localState.farm_plots[i];
        if (plotData) {
          const plant = plantTypes[plotData.type];
          const isReady = plotData.ready;
          
          plot.textContent = isReady ? plant.emoji : 'üå±';
          plot.classList.remove('growing', 'ready');
          plot.classList.add(isReady ? 'ready' : 'growing');
        } else {
          plot.textContent = '';
          plot.classList.remove('growing', 'ready');
        }
      });
    }

    function updatePlantGrowth() {
      const now = Date.now();
      const growTime = getGrowTime();
      let changed = false;
      
      Object.keys(localState.farm_plots).forEach(index => {
        const plotData = localState.farm_plots[index];
        if (plotData && !plotData.ready) {
          if (now - plotData.plantedAt >= growTime) {
            plotData.ready = true;
            changed = true;
            checkMutations(parseInt(index));
          }
        }
      });
      
      if (changed) {
        saveToLocalStorage();
        updateFarmGrid();
      }
    }

    function getAdjacentPlots(index) {
      const adjacent = [];
      const row = Math.floor(index / 6);
      const col = index % 6;
      
      if (row > 0) adjacent.push(index - 6);
      if (row < 3) adjacent.push(index + 6);
      if (col > 0) adjacent.push(index - 1);
      if (col < 5) adjacent.push(index + 1);
      
      return adjacent;
    }

    function checkMutations(index) {
      const plotData = localState.farm_plots[index];
      if (!plotData || !plotData.ready || plotData.type === 'golden') return;
      
      const adjacentIndices = getAdjacentPlots(index);
      const samePlantAdjacent = adjacentIndices.filter(i => {
        const adj = localState.farm_plots[i];
        return adj && adj.type === plotData.type && adj.ready;
      });
      
      if (samePlantAdjacent.length > 0) {
        const mutationChance = getMutationChance() * samePlantAdjacent.length;
        
        if (Math.random() < mutationChance) {
          plotData.type = 'golden';
          
          const plot = document.getElementById('plot-' + index);
          if (plot) {
            plot.classList.add('mutating');
            setTimeout(() => plot.classList.remove('mutating'), 600);
          }
        }
      }
    }

    function plantSinglePlot(plotIndex) {
      if (!selectedPlant) return;
      
      const plant = plantTypes[selectedPlant];
      
      if (localState.farm_plots[plotIndex]) {
        const oldPlant = localState.farm_plots[plotIndex];
        const oldPlantType = plantTypes[oldPlant.type];
        localState.coins += oldPlantType.value * localState.multiplier * PLANT_EARNINGS_MULTIPLIER;
      }
      
      if (localState.coins >= plant.cost) {
        localState.coins -= plant.cost;
        localState.farm_plots[plotIndex] = {
          type: selectedPlant,
          plantedAt: Date.now(),
          ready: false
        };
        saveToLocalStorage();
        updateUI();
      }
    }

    function plantMultiplePlots(startIndex) {
      if (!selectedPlant) return;
      
      const plant = plantTypes[selectedPlant];
      let tempCoins = localState.coins;
      const plotsToPlant = [];
      
      for (let i = 0; i < 24; i++) {
        if (localState.farm_plots[i]) {
          const oldPlant = localState.farm_plots[i];
          const oldPlantType = plantTypes[oldPlant.type];
          tempCoins += oldPlantType.value * localState.multiplier * PLANT_EARNINGS_MULTIPLIER;
        }
        
        if (tempCoins >= plant.cost) {
          tempCoins -= plant.cost;
          plotsToPlant.push(i);
        }
      }
      
      plotsToPlant.forEach(i => {
        if (localState.farm_plots[i]) {
          const oldPlant = localState.farm_plots[i];
          const oldPlantType = plantTypes[oldPlant.type];
          localState.coins += oldPlantType.value * localState.multiplier * PLANT_EARNINGS_MULTIPLIER;
        }
        
        localState.coins -= plant.cost;
        localState.farm_plots[i] = {
          type: selectedPlant,
          plantedAt: Date.now(),
          ready: false
        };
      });
      
      saveToLocalStorage();
      updateUI();
    }

    function hoverHarvest(plotIndex) {
      const plotData = localState.farm_plots[plotIndex];
      
      if (plotData && plotData.ready) {
        const plant = plantTypes[plotData.type];
        localState.coins += plant.value * localState.multiplier * PLANT_EARNINGS_MULTIPLIER;
        delete localState.farm_plots[plotIndex];
        
        const plot = document.getElementById('plot-' + plotIndex);
        if (plot) {
          plot.classList.add('harvesting');
          setTimeout(() => plot.classList.remove('harvesting'), 300);
        }
        
        saveToLocalStorage();
        updateUI();
      }
    }

    function harvestAll() {
      let totalEarnings = 0;
      Object.keys(localState.farm_plots).forEach(index => {
        const plotData = localState.farm_plots[index];
        const plant = plantTypes[plotData.type];
        totalEarnings += plant.value * localState.multiplier * PLANT_EARNINGS_MULTIPLIER;
      });
      
      localState.coins += totalEarnings;
      localState.farm_plots = {};
      
      saveToLocalStorage();
      updateUI();
    }

    function clearFarm() {
      localState.farm_plots = {};
      saveToLocalStorage();
      updateUI();
    }

    window.addEventListener('DOMContentLoaded', initGame);
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9cde125666817b16',t:'MTc3MTA4NzkwMS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>